# 외부 서비스 정보

## 개요

이 문서는 **흥부자(Heungbuja)** 서비스에서 사용하는 외부 서비스(SSAFY GMS, AWS S3 등)의 발급 방법과 설정 값을 정리한 문서입니다.  
실제 키/비밀번호 값은 모두 `.env` 에서 관리하며, Git 저장소에 커밋하지 않습니다.

---

## 1. SSAFY GMS (OpenAI Proxy)

- **제공자**: SSAFY GMS
- **용도**: OpenAI GPT 계열 모델(GPT-5-nano 등)을 GMS 프록시를 통해 호출
- **공식 문서**: SSAFY GMS 가이드 참고

### 1-1. 계정 및 키 발급

1. SSAFY GMS 포털 접속  
   - 교육장/담당자가 제공하는 GMS 포털 URL 접속
2. 계정 생성 및 권한 신청  
   - SSAFY 계정으로 로그인 후, 프로젝트용 GMS 사용 권한 요청
3. API Key 발급  
   - GMS 포털 내 API Key 발급 메뉴에서 **프로젝트 전용 키** 생성

### 1-2. 환경 변수 매핑

발급받은 키는 `.env` 에 아래 변수로 설정합니다.

```env
OPENAI_GMS_API_KEY=발급받은_gms_api_key
```

Spring Boot 설정(`backend/spring-server/src/main/resources/application.yml`)에서는 다음과 같이 사용합니다.

- `openai.gms.api-key` → `OPENAI_GMS_API_KEY`
- `gpt.api.key`       → `OPENAI_GMS_API_KEY`
- 사용 모델: `gpt-5-nano`

> 운영/개발 환경별로 키를 분리하고 싶다면 서버별 `.env` 를 나눠 관리합니다.

---

## 2. AWS S3

- **제공자**: Amazon Web Services
- **용도**: 음성(TTS) 파일 등 정적 리소스 저장
- **공식 문서**: https://docs.aws.amazon.com/s3/

### 2-1. AWS 계정 및 IAM 사용자

1. **AWS 계정 생성**
   - https://aws.amazon.com/ 접속 후, 개인/조직 계정 생성
2. **IAM 사용자 생성**
   - 콘솔에서 `IAM` 서비스 이동 → `Users` → `Add user`
   - 사용자 이름 예시: `heungbuja-s3-user`
   - `Programmatic access` 활성화
   - 권한:
     - 초기에는 `AmazonS3FullAccess` 정책을 부여하고, 이후 최소 권한으로 좁히는 것을 권장
3. **액세스 키 발급**
   - 사용자 생성 시 발급되는 `Access Key ID`, `Secret Access Key` 를 안전한 곳에 저장

### 2-2. S3 버킷 생성

1. `S3` 서비스 이동 후 `Create bucket` 클릭
2. 버킷 이름 예시: `heungbuja-bucket`
3. 리전: `Asia Pacific (Seoul) ap-northeast-2`
4. 퍼블릭 액세스 차단 정책은 서비스 요구사항에 맞게 설정  
   - 일반적으로는 **퍼블릭 읽기 최소화** + **프리사인드 URL 사용**을 권장

### 2-3. 환경 변수 매핑

`.env` 파일에 아래와 같이 설정합니다.

```env
AWS_ACCESS_KEY_ID=발급받은_access_key_id
AWS_SECRET_ACCESS_KEY=발급받은_secret_access_key
APP_S3_BUCKET=heungbuja-bucket
APP_S3_REGION=ap-northeast-2
APP_S3_URL_TTL_MINUTES=30
```

Spring 설정(`application.yml`)에서 참조하는 값:

- `app.s3.bucket`  → `APP_S3_BUCKET`
- `app.s3.region`  → `APP_S3_REGION`
- `app.s3.url-ttl-minutes` → `APP_S3_URL_TTL_MINUTES`

---

## 3. SSAFY OpenAI GMS STT/TTS

- **제공자**: SSAFY GMS
- **용도**: 음성 인식(STT), 음성 합성(TTS)

이미 1번에서 발급한 `OPENAI_GMS_API_KEY` 를 그대로 사용합니다.

### 3-1. API 엔드포인트 (Spring 설정 기준)

`application.yml` 기준:

- STT: `https://gms.ssafy.io/gmsapi/api.openai.com/v1/audio/transcriptions`
- TTS: `https://gms.ssafy.io/gmsapi/api.openai.com/v1/audio/speech`

환경 변수:

```env
OPENAI_GMS_API_KEY=발급받은_gms_api_key
TTS_STORAGE_PATH=./tts-files  # 필요 시 변경
```

---

## 4. 도메인 및 HTTPS (Nginx + Certbot)

- **도메인 예시**: `heungbuja.site`, `www.heungbuja.site`
- **역할**:
  - Nginx: 리버스 프록시 및 정적 파일 서빙
  - Certbot: Let’s Encrypt 기반 SSL/TLS 인증서 발급

### 4-1. 도메인 설정

1. 도메인 구매 (가비아, Namecheap 등)
2. DNS A 레코드 설정
   - `heungbuja.site` → 운영 서버 공인 IP
   - `www.heungbuja.site` → 운영 서버 공인 IP

### 4-2. 인증서 발급 (Docker 기반)

`docker-compose.yml` 의 `certbot` 서비스가 다음 도메인에 대해 인증서를 발급합니다.

- `-d heungbuja.site -d www.heungbuja.site`

인증서 관련 데이터 디렉터리:

- `certbot/conf`
- `certbot/www`
- `nginx/certs` (필요 시 참고)

> 최초 발급 시 `docker compose up certbot` 으로 단독 실행해 확인한 뒤, Nginx와 함께 전체 스택을 올리는 것을 추천합니다.

---

## 5. 계정 관리 및 보안

### 5-1. 공통 규칙

- 모든 외부 서비스 키는 **반드시 `.env` 환경 변수**로 관리
- 키/비밀번호는 정기적으로 교체(분기 1회 이상 권장)
- `.env` 파일은 Git에 커밋 금지 (`.gitignore` 에 이미 포함)

### 5-2. 최소 권한 원칙

- AWS IAM:
  - S3 만 사용하는 경우, 해당 버킷에 대한 최소 권한 정책으로 축소
- GMS 키:
  - 프로젝트별 별도 키 사용, 필요 없는 프로젝트 키는 삭제

### 5-3. 모니터링

- AWS S3: CloudWatch 또는 Billing 대시보드로 사용량 및 비용 모니터링
- SSAFY GMS: 제공되는 사용량/쿼ота 대시보드가 있다면 정기 확인

---

## 6. 요약: 외부 서비스별 핵심 환경 변수

- **SSAFY GMS / GPT**
  - `OPENAI_GMS_API_KEY`
- **AWS S3**
  - `AWS_ACCESS_KEY_ID`
  - `AWS_SECRET_ACCESS_KEY`
  - `APP_S3_BUCKET`
  - `APP_S3_REGION`
  - `APP_S3_URL_TTL_MINUTES`
- **TTS 저장 경로**
  - `TTS_STORAGE_PATH`

위 변수들만 올바르게 설정되어 있으면, 흥부자 서비스의 외부 연동 기능(GMS 기반 GPT, STT/TTS, S3 파일 저장)은 정상 동작합니다.

